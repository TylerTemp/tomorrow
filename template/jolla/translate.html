{% extends "base.html" %}

{% block main_title %}
  {{ _("Translate") }}: {{ source.title or (article.source and article.source['title']) or '[EMPTY]' }}
{% end %}

{% block neck %}
<link rel="stylesheet" href="/static/css/editor.css">

<style>
.am-g-fixed {
  max-width: none;
}

#preview_popup p img {
  max-width: 100%;
  height: auto;
  margin: 0 0 0 -2em;
}

#preview_popup p {
  text-indent: 2em;
}

#preview_popup .footnote p {
  text-indent: 0;
}

video {
  width: 100%;
  height: auto;
}

a.white {
  color: white;
}

a.white:hover {
  color: #e4e4e4;
}

</style>
{% end %}
{% block stomach %}

<div class="am-margin">
  <div class="header">
    <div class="am-g">
      <h1>{{ _("Translate") }}: {{ source.title or article.source.get('title', '') }}</h1>
    </div>
    <hr />
  </div>

  <form>
    <fieldset>
      {% raw xsrf_form_html() %}
      <!-- title -->
      <div class="am-form-group">
        <label for="title">{{ _("Title") }}</label>
        <input type="text" class="am-form-field" id="title" value="{{ article.title }}" placeholder="{{ source.title or '' }}">
      </div>
      <!-- description -->
      <div class="am-form-group">
        <label for="description">{{ _("Description") }}</label>
        <textarea class="am-form-field" id="description" placeholder="{{ _('Enter the description of this post') }}">{{ article.description or '' }}</textarea>
      </div>

      <!-- More -->
      <a data-am-collapse href="#more" class="white">{{ _('More') }} <span class="am-icon-angle-double-right"></span></a>
      <div id="more" class="am-collapse">
        <div class="am-form-group">
          <label for="source-link">{{ _('Source Link') }}: </label>
          <a class="white" id="source-link" href="{{ source.link }}" target="_blank">{{ source.link }} <span class="am-icon-external-link"></span> </a>
        </div>
        <div class="am-form-group">
          <label for="original-author">{{ 'Original Author' }}</label>
          <input type="text" class="am-form-field" id="original-author" name="original-author" value="{{ source.author or '' }}" />
        </div>
        <div class="am-form-group">
          <label for="cover">{{ 'Cover' }}</label>
          <input type="text" class="am-form-field" id="cover" name="cover" value="{{ article.cover or source.cover or '' }}" />
        </div>
        <div class="am-form-group">
          <label for="banner">{{ 'Banner' }}</label>
          <input type="text" class="am-form-field" id="banner" name="banner" value="{{ article.banner or source.banner or '' }}" />
        </div>
      </div>

      <hr />

      <div class="am-form-group">
        <div class="am-btn-toolbar" id="mdEditorToolbar">
          {% module MdBar(upload_img=imgs, upload_file=files) %}
          <div class="am-btn-group">
            <button type="button" class="am-btn am-btn-danger am-radius" data-role="preview" data-am-modal="{target: '#preview_popup'}" data-am-popover="{content: '{{ _('Preview') }}', trigger: 'hover focus'}"><span class="am-icon-eye"></span></button>
          </div>
        </div>
        <!-- translated area -->
        <textarea class="am-form-field" name="content" id="mdEditor" tabindex="0" placeholder="&#xe601; {{ _('Markdown syntax supported') }}">
          {{ article.content or '' }}
        </textarea>
      </div>

      <div class="am-form-group">
        <button type="submit"
                class="am-btn am-btn-success am-fr"
                data-am-loading="{spinner: 'ge', loadingText: ''}">
          <span class="am-icon-arrow-up"> {{ _("Submit") }}</span>
        </button>
      </div>
    </fieldset>
  </form>
</div>

<div class="am-popup" id="preview_popup">
  <div class="am-popup-inner">
    <div class="preview am-g">
      <div class="am-u-sm-12 am-u-md-6 description"></div>
      <div class="am-u-sm-12 am-u-md-6 banner"></div>
    </div>
    <div class="am-popup-hd">
      <article class="am-article">
        <div class="am-article-hd">
          <h2 class="am-article-title"></h2>
        </div>
        <div class="am-article-bd">
          <!--<p class="am-article-lead"></p>-->
        </div>
      </article>
    </div>
    <div class="am-popup-bd">
    </div>
  </div>
</div>
{% end %}

{% block leg %}
<script src="https://dn-tomorrow.qbox.me/jquery-textrange.min.js"></script>
<script src="https://dn-tomorrow.qbox.me/showdown.min.js"></script>
<script src="/static/js/md/editor-md.js"></script>
<script src="/static/js/jolla/translate.js"></script>
{% end %}
