{% extends "base.html" %}

{% block title %}
  {{ _("Translate") }}: {{ translate['title'] }}
{% end %}

{% block neck %}
<link rel="stylesheet" href="/static/css/editor.css">

<style>

header {
  text-align: center;
}

header img {
  width: 100%;
  height: auto;
  max-width: 400px;
}

/*#article-area,*/
#article-wys,
#article-md,
#mdEditor,
#wysiwygEditor {
  height: 600px;
}


#title {
  margin-bottom: 5px;
}

#white-box {
  background-color: #fff;
}

#bread-crumbs {
  color: #fff;
}

#bread-crumbs a:link {
  color: #fff;
}
#bread-crumbs a:visited {
  color: #fff;
}
#bread-crumbs a:hover {
  color: #fff;
  text-decoration:underline;
}

#preview_popup p img {
  max-width: 100%;
  height: auto;
  margin: 0em 0em 0em -2em;
}

#preview_popup p {
  text-indent: 2em;
}

#preview_popup .footnote p {
  text-indent: 0em;
}

video {
  width: 100%;
  height: auto;
}

</style>
{% end %}
{% block body %}
<header>
  <div class="am-g am-center">
    <div class="am-u-sm-12" style="text-align:center">
      <a href="/jolla/blog/"><img alt="{{ _("Jolla Unofficical Chinese Blog") }}" src="/static/img/blog_header.png"></a>
    </div>
  </div>
</header>

<div class="am-g" id="bread-crumbs">
  <div class="am-u-sm-12" style="text-align: left">
    <span class="am-icon-angle-right"><a href="/jolla/">{{ _('Home')}}</a></span> &nbsp;
    <span class="am-icon-angle-right"><a href="/jolla/translate/">{{ _('Translate')}}</a></span> &nbsp;
    <span class="am-icon-caret-right">{{ translate['title'] }}</span>
  </div>
</div>

<div>
  <div class="am-margin" id="white-box">
    <div class="header">
      <div class="am-g">
        <h1>{{ _("Translate") }}: {{ translate['title'] }}</h1>
      </div>
      <hr />
    </div>

    <!-- title -->
    <div class="am-g">
      <div class="am-u-sm-12">
        <label for="title">{{ _("Title") }}: {{ translate['title'] }}</label>
        <input type="text" class="am-form-field" id="title" value="{{ translated['title'] }}" placeholder="{{ _('Enter the translation of the title') }}">
      </div>
    </div>
    <!-- description -->
    <div class="am-g">
      <div class="am-u-sm-12">
        <label for="description">{{ _("Description") }}:</label>
        <textarea type="text" class="am-form-field" id="description" placeholder="{{ _('Enter the description of this post') }}">{{ translated['description'] }}</textarea>
      </div>
    </div>

    <hr />

    <!-- toolbar -->
    <div class="am-g">
      <div class="am-u-sm-12 am-btn-toolbar" id="wysiwygEditorToolbar" style="{{ 'display:none' if md else '' }}">
        {% module WysBar(upload_img=imgs, upload_file=files) %}
        <div class="am-btn-group">
          <button type="button" class="am-btn am-btn-success am-radius" id="switch-to-md" data-am-popover="{content: '{{ _('Switch to MarkDown Editor') }}', trigger: 'hover focus'}"><span class="iconfont icon-mdsolid"></span></button>
          <button type="button" class="am-btn am-btn-danger am-radius" data-role="preview" data-am-modal="{target: '#preview_popup'}" data-am-popover="{content: '{{ _('Preview') }}', trigger: 'hover focus'}"><span class="am-icon-eye"></span></button>
        </div>
      </div>
    </div>
    <div class="am-g">
      <div class="am-u-sm-12 am-btn-toolbar" id="mdEditorToolbar" style="{{ '' if md else 'display:none' }}">
        {% module MdBar(upload_img=imgs, upload_file=files) %}
        <div class="am-btn-group">
          <button type="button" class="am-btn am-btn-success am-radius" id="switch-to-wysiwyg" data-am-popover="{content: '{{ _('Switch to WYSIWYG Editor') }}', trigger: 'hover focus'}"><span class="am-icon-edit"></span></button>
          <button type="button" class="am-btn am-btn-danger am-radius" data-role="preview" data-am-modal="{target: '#preview_popup'}" data-am-popover="{content: '{{ _('Preview') }}', trigger: 'hover focus'}"><span class="am-icon-eye"></span></button>
        </div>
      </div>
    </div>

    <div class="am-g">
      <!-- translated area -->
      <div class="am-u-sm-12 am-u-md-6" id="left">
        <label>{{ _("Translate Here") }}: </label>
        <div class="am-form-field needsclick" id="wysiwygEditor" style="{{ 'display:none' if md else '' }}" tabindex="0" contentEditable="true">
          {% raw translated['html'] or '' %}
        </div>
        <textarea class="am-form-field" id="mdEditor" style="{{ '' if md else 'display:none' }}" tabindex="0" placeholder="&#xe601; {{ _('Markdown syntax supported') }}">
          {{ translated['md'] or '' }}
        </textarea>
        <div class="am-cf">
          <button class="am-btn am-btn-secondary am-fr" id="source-show" style="display:none"><span class="am-icon-eye"> {{ _("Show Source") }}</span></button>
        </div>
      </div>
      <!-- original content -->
      <div class="am-u-sm-12 am-u-md-6" id="right">
        <div id="article-area">
          <label>{{ _("Original Content") }}: </label>
          <div class="am-scrollable-vertical" id="article-wys" style="{{ 'display:none' if md else '' }}">
            {% raw translate['html'] %}
          </div>
          <textarea class="am-form-field" id="article-md" style="{{ '' if md else 'display:none' }}">
            {% raw translate['md'] %}
          </textarea>
        </div>
        <div class="am-cf">
          <button class="am-btn am-btn-secondary am-fr" id="source-hide"><span class="am-icon-eye-slash"></span> {{ _("Hide Source") }}</button>
          <button class="am-btn am-btn-success am-fr" id="article-switch" data-role="{{'md' if md else 'wys'}}">{{ _("Switch to") }} {{ _("normal view" if md else "MarkDown")}}</button>
          {% if edit_task_url %}
          <a class="am-btn am-btn-default am-fr" id="source-edit" href="{{ edit_task_url }}" target="_blank">{{ _("Edit Source") }}</a>
          {% end %}
        </div>
      </div>

    </div>

    <hr class="am-divider am-divider-default">

    <div id="submit-error-panel">
    </div>

    <!-- show/hide email -->
    <div class="am-g">
      <div class="am-u-sm-12">
        <label>
          <input type="checkbox" class="am-checkbox-inline" id="hide-email" checked>
          {{ _("Hide my email") }}
        </label>
      </div>
    </div>

    <!-- license -->
    <div class="am-g">
      <div class="am-u-sm-12">
        <p>{% raw _("Don't forget to announce a license at the end of your work. {mark}Creative Commons{mark_end} is strongly suggested.").format(mark='<a href="https://creativecommons.org/choose/?lang=zh_CN&jurisdiction=cn" target="_blank"><span class="am-icon-cc"> ', mark_end='</span></a>') %}
        </p>
      </div>
    </div>

    <div class="am-g">
      <div class="am-u-sm-12">
        <button type="button"
                class="am-btn am-btn-success"
                id="submit"
                data-am-loading="{spinner: 'circle-o-notch', loadingText: ''}">
          <span class="am-icon-arrow-up"> {{ _("Submit") }}</span>
        </button>
      </div>
    </div>

    <br>

  </div>
</div>

<div class="am-popup" id="preview_popup">
  <div class="am-popup-inner">
    <div class="am-popup-hd">
      <h2 class="am-popup-title"></h2>
      <span data-am-modal-close
            class="am-close">
        &times;
      </span>
    </div>
    <div class="am-popup-bd">
    </div>
  </div>
</div>
{% end %}

{% block leg %}
<script>
  var IMGUPLOADURL = "{{ img_upload_url }}";
  var FILEUPLOADURL = "{{ file_upload_url }}";
  var SIZELIMIT = {{ "undefined" if size_limit == float("inf") else size_limit }};
  var _editor_status = "{{ 'md' if md else 'wysiwyg' }}";
</script>
<script src="https://dn-tomorrow.qbox.me/jquery-textrange.min.js"></script>
<script src="https://dn-tomorrow.qbox.me/html2md.min.js"></script>
<!-- <script src="https://dn-tomorrow.qbox.me/md2html.min.js"></script> -->
<script src="https://dn-tomorrow.qbox.me/showdown.min.js"></script>
<script src="/static/js/md/editor-wysiwyg.js"></script>
<script src="/static/js/md/editor-md.js"></script>
<script src="/static/js/jolla/translate.js"></script>
{% end %}
